# パスベース設定システム仕様

## 概要

パスベース設定システムは、ファイルパスパターンに基づいてレビュー方針やルールを定義する機能を提供します。このシステムにより、ファイルの種類や場所に応じて適切なレビュー指示を設定できます。

## 設定ファイル

### 基本構造

設定ファイルは `.coderabbitai.yaml` という名前でプロジェクトのルートディレクトリに配置します。

```yaml
# パスベースのレビュー指示
file_path_instructions:
  - path: "src/**/*.{ts,tsx}"
    instructions: |
      TypeScriptコードのレビュー指示：
      - 型の適切な使用
      - nullチェックの完全性
      - 非同期処理の適切な実装

  - path: "test/**/*.ts"
    instructions: |
      テストコードのレビュー指示：
      - テストケースの網羅性
      - エッジケースの考慮
      - テストの独立性確保

# パスフィルター（レビュー対象外のパス）
path_filters: |
  !dist/**
  !*.min.js
  !*.map

# シンプルな変更のスキップ設定
skip_simple_changes: true
```

## 設定項目

### file_path_instructions

```typescript
interface PathInstruction {
  /** Globパターンによるファイルパスの指定 */
  path: string;
  
  /** そのパスパターンに対する具体的なレビュー指示 */
  instructions: string;
}
```

- `path`: [minimatch](https://github.com/isaacs/minimatch) 形式のGlobパターン
- `instructions`: マークダウン形式のレビュー指示

### path_filters

- レビュー対象から除外するファイルパスパターン
- 各行が1つのパターンとして解釈される
- `!` プレフィックスで除外パターンを指定
- デフォルトで以下のパターンが除外される：
  ```yaml
  !dist/**
  !**/*.min.js
  !**/*.map
  !**/node_modules/**
  ```

### skip_simple_changes

- シンプルな変更をスキップするかどうかのフラグ
- 以下の変更がシンプルな変更として扱われる：
  - フォーマットの変更のみ
  - コメントの追加・修正のみ
  - 空白行の変更のみ

## パターンマッチング

### マッチングの優先順位

1. より具体的なパターンが優先される
2. 設定ファイル内での順序が考慮される
3. 複数のパターンにマッチする場合、すべての指示が結合される

### パターンの制約

- 相対パスのみサポート
- プロジェクトルートからの参照
- ワイルドカード（`*`, `**`）使用可能
- 複数の拡張子は `{js,ts}` のように指定

## エラー処理

### 設定ファイルのエラー

1. **ファイルが存在しない場合**
   - デフォルト設定を使用
   - 警告ログを出力

2. **構文エラーの場合**
   - エラー内容を報告
   - デフォルト設定を使用

3. **無効なパターンの場合**
   - 該当パターンをスキップ
   - 警告ログを出力

## 使用例

### 1. 基本的な設定

```yaml
file_path_instructions:
  - path: "src/**/*.ts"
    instructions: "TypeScriptコードの標準レビュー"
```

### 2. 複数パターンの設定

```yaml
file_path_instructions:
  - path: "src/api/**/*.ts"
    instructions: |
      APIエンドポイントのレビュー基準：
      - 入力値の検証
      - エラーハンドリング
      - レスポンス形式

  - path: "src/models/**/*.ts"
    instructions: |
      モデルの実装基準：
      - 不変性の確保
      - バリデーションルール
      - 型の完全性
```

### 3. 特定ファイルの除外

```yaml
path_filters: |
  !src/generated/**
  !**/*.test.ts
  !**/*.spec.ts
```

## 注意事項

1. **パターンの検証**
   - 設定読み込み時に構文チェック
   - 無効なパターンは警告付きでスキップ

2. **指示内容の制約**
   - マークダウン形式のみサポート
   - プレーンテキストとして解釈
   - 特殊な制御文字は無視

3. **パフォーマンス考慮**
   - パターンキャッシュの活用
   - 最適化されたマッチングアルゴリズム
   - 不要なファイルの早期スキップ