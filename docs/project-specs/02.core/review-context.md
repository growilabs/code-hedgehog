# レビューコンテキスト管理の基本方針と非採用事項

**重要:** Code Hedgehog のレビューコンテキスト管理は、GitHub Actions をベースとし、コンテキスト収集・管理の多くを GitHub の標準機能 (コメントスレッド、Resolve conversation、Checks API) に依存しています。このドキュメントでは、その基本方針と、過去の検討段階で挙がったものの**現在の設計では採用していない事項**について説明します。

現在のコンテキスト収集・管理に関する具体的な仕様は、以下のドキュメントを参照してください。
-   [GitHub Bot 仕様](../../project-specs/05.github-bot/overview.md) (特にセクション 2.2 コンテキスト収集)
-   [GitHub Bot: コメント関連機能仕様](../../project-specs/05.github-bot/comment-chain-features.md)

---

## 1. 基本方針

Code Hedgehog のレビューコンテキスト管理における基本方針は以下の通りです。

-   **GitHub 機能への依存:** コメントの階層構造（スレッド）や指摘の解決状態（Resolve conversation）は、GitHub が提供する機能を最大限に活用します。
-   **Bot の責務最小化:** Bot (Action Runner) は、GitHub API を通じてこれらの情報を取得・利用しますが、独自にこれらの情報を永続化・管理する責務は最小限に抑えられます。
-   **プロセッサへの情報提供:** Bot (Action Runner) は、収集したコンテキスト情報（PR情報、ファイル差分、コメント履歴など）を整形し、`ProcessInput` または `InteractionInput` という形でプロセッサに提供します。プロセッサは提供された情報を基にレビューや応答生成を行います。

## 2. 現在の設計で採用していない事項

過去の設計検討段階では、より複雑な Bot 独自のコンテキスト管理機能が議論されましたが、現在の GitHub Actions ベースのアーキテクチャでは、以下の事項は Bot 自身の責務としては採用していません。

-   **独自のコンテキストデータベースの構築・運用:**
    -   Bot がレビューコメント、レビュー履歴、インタラクション履歴などを独自のデータベース (Bot DB) で永続的に管理・追跡することは行いません。コンテキスト情報は主に GitHub API から実行時に取得されます。
-   **Bot 内部での詳細なコメント状態管理:**
    -   Bot がコメントに対して独自のID体系、親子関係、レビューの側面（アスペクト）、フェーズ、詳細な状態（例: `open`, `resolved`, `outdated`）を内部で厳密に管理することは行いません。これらの多くは GitHub の機能や、プロセッサが受け取った情報から判断します。
-   **Bot 内部での専用コンテキストマネージャーやプロバイダーインターフェース:**
    -   Bot 内部に、プロセッサが直接呼び出して Bot 管理下のコンテキスト情報を取得・操作するための専用モジュール（例: `ContextManager`, `ContextProvider` インターフェース）を設けることはありません。必要なコンテキストは `Action Runner` からプロセッサへ一方向的に渡されます。
-   **Bot 自身によるレビュー履歴からの学習・最適化:**
    -   プロセッサは渡されたコメント履歴 (`commentHistory`) を参照して重複指摘の回避や文脈理解の向上を図ることがありますが、Bot 自身が過去の指摘パターンを長期的に蓄積・学習し、レビュー精度を自動的に向上させるような仕組みは持ちません。
-   **Bot 内部でのインクリメンタルな更新処理:**
    -   レビュー対象の変更に対して、過去のレビュー状態との差分のみを処理するような、Bot 内部での高度なインクリメンタル更新ロジックは現時点では実装されていません。
-   **Bot 独自の永続化層のプラグイン可能性:**
    -   Bot が使用するデータ永続化の仕組みをプラグイン可能にするような設計は、現在のアーキテクチャでは主要な関心事ではありません。拡張性は主にプロセッサの追加・選択や GitHub Actions ワークフローのカスタマイズによって確保されます。

これらの「採用していない事項」を明確にすることで、現在の Code Hedgehog のアーキテクチャにおける Bot (Action Runner) とプロセッサの役割分担、および GitHub プラットフォームへの依存関係をより明確に理解することができます。
